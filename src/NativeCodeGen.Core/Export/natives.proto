syntax = "proto3";

package rdr3natives;

// Bitflags for parameter attributes
// Can be combined: Output | This = 3
enum ParamFlags {
  PARAM_NONE = 0;
  PARAM_OUTPUT = 1;    // Pointer output parameter
  PARAM_THIS = 2;      // @this - instance method receiver
  PARAM_NULLABLE = 4;  // @nullable - string can be null
  PARAM_IN = 8;        // @in - input+output pointer
}

// Bitflags for struct field attributes
// Can be combined for special cases
enum FieldFlags {
  FIELD_NONE = 0;
  FIELD_IN = 1;        // @in - setter only
  FIELD_OUT = 2;       // @out - getter only
  FIELD_PADDING = 4;   // @padding - no accessors
}

message Database {
  repeated Namespace namespaces = 1;
  repeated Enum enums = 2;
  repeated Struct structs = 3;
  repeated SharedExample shared_examples = 4;
  repeated TypeEntry types = 5;
}

enum TypeCategory {
  TYPE_PRIMITIVE = 0;
  TYPE_HANDLE = 1;
  TYPE_HASH = 2;
  TYPE_VECTOR3 = 3;
  TYPE_STRING = 4;
  TYPE_VOID = 5;
  TYPE_ANY = 6;
}

message TypeInfo {
  TypeCategory category = 1;
  optional string native_type = 2;
  optional string description = 3;
}

message TypeEntry {
  string name = 1;
  TypeInfo type = 2;
}

message Namespace {
  string name = 1;
  repeated Native natives = 2;
}

message Native {
  string name = 1;
  string hash = 2;
  string namespace = 3;
  string description = 4;
  repeated Parameter parameters = 5;
  string return_type = 6;
  string return_description = 7;
  repeated string aliases = 8;
  repeated string used_enums = 9;
  string apiset = 10;
  repeated string related_examples = 11;
}

message Parameter {
  string name = 1;
  string type = 2;
  string description = 3;
  uint32 flags = 4;    // ParamFlags bitfield
  optional string default_value = 5;
}

message Enum {
  string name = 1;
  optional string base_type = 2;
  repeated EnumMember members = 3;
  repeated string used_by_natives = 4;
}

message EnumMember {
  string name = 1;
  optional string value = 2;
}

message Struct {
  string name = 1;
  repeated StructField fields = 2;
  repeated string used_by_natives = 3;
  optional int32 default_alignment = 4;
}

message StructField {
  string name = 1;
  string type = 2;
  optional string comment = 3;
  uint32 flags = 4;    // FieldFlags bitfield
  int32 array_size = 5;
  optional string nested_struct_name = 6;
  optional int32 alignment = 7;
}

message SharedExample {
  string name = 1;
  string title = 2;
  repeated SharedExampleCode examples = 3;
}

message SharedExampleCode {
  string content = 1;
  optional string language = 2;
}
